<?php/** * Created by PhpStorm. * User: Zhumadilov * Date: 19.11.2018 * Time: 14:14 */namespace frontend\components;use Yii;use yii\base\InvalidConfigException;use yii\helpers\ArrayHelper;use yii\helpers\Html;use yii\helpers\Url;use yii\base\Component;class Lang extends Component{    public $addCurrentLang;    public $calling_controller;    public $image_type;    public $link_home;    public $widget_type;    public $width;    /**     * @throws InvalidConfigException     */    public function init()    {        parent::init();        // Exception IF params -> languages not defined        if (!isset(Yii::$app->urlManager->languages)) {            throw new InvalidConfigException("You must define Yii::\$app->urlManager->languages array like ['it', 'en', 'fr', 'de', 'es']");        }        // Add Current Lang        if (!$this->addCurrentLang) {            $this->addCurrentLang = false;        }        // Icon Width        if (!$this->width) {            $this->width = '24';        }        // Image Type        if (!$this->image_type) {            $this->image_type = 'classic';        }        // Link Home        if (!$this->link_home) {            $this->link_home = false;        }        // Widget Type        if (!$this->widget_type) {            $this->widget_type = 'classic';        }    }    public function run($params = [])    {        $currentLang = Yii::$app->language;        $languages = Yii::$app->urlManager->languages;        if ((string)$this->widget_type === 'selector') {            $action = 'languageSelector';        } else {            $action = 'languageClassic';        }        if (method_exists($this, $action)) {            return $this->$action($currentLang, $languages);        } else {            return ['label' => '#'];        }    }    private function languageClassic($currentLang, $languages)    {        list($route, $params) = Yii::$app->getUrlManager()->parseRequest(Yii::$app->getRequest());        $params = ArrayHelper::merge($_GET, $params);        $url = isset($params['route']) ? $params['route'] : $route;        $items = [];        foreach ($languages as $language) {            if ($this->link_home) {                $url_lang = Yii::$app->urlManager->createUrl([                        'site/index',                        'language' => $language]                );            } else {                $url_lang = Yii::$app->urlManager->createUrl(ArrayHelper::merge(                    $params, [$url, 'language' => $language]                ));            }            $url_image = Url::to('@web/img/flags/' . $this->image_type . '/' . $language . '.png');            if ($language !== $currentLang || $this->addCurrentLang) {                $items[] = [                    'label' => Html::img($url_image, [                        'width' => $this->width,                        'alt' => $language,                        'title' => $language,                    ]),                    'url' => $url_lang,                ];            }        }        return $items;    }}