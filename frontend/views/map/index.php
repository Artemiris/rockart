<?php/* @var $this yii\web\View */use yii\helpers\Html;use yii\widgets\ActiveForm;use yii\helpers\Url;$this->title = Yii::t('app', 'Map');$this->params['breadcrumbs'] = [    $this->title,];$script = <<< JSvar arr = $json_petroglyphs;JS;$script2 = <<< JS    $(document).ready(function() {    $("#imagetype_dropdown li a").click(        function () {             $('#imagetype_button').html($(this).text() + ' <span class="caret"></span>');            changeImageType($(this).attr('id'));        });    $("#epoch_dropdown li a").click(function () {        $('#epoch_button').html($(this).text() + ' <span class="caret"></span>');        $('#epoch_button').val($(this).attr('id'));        filter()});    $("#culture_dropdown li a").click(function () {        $('#culture_button').html($(this).text() + ' <span class="caret"></span>');        $('#culture_button').val($(this).attr('id'));        filter()});    $("#method_dropdown li a").click(function () {        $('#method_button').html($(this).text() + ' <span class="caret"></span>');        $('#method_button').val($(this).attr('id'));        filter()});    $("#style_dropdown li a").click(function () {        $('#style_button').html($(this).text() + ' <span class="caret"></span>');        $('#style_button').val($(this).attr('id'));        filter()});});function filter(){    hideMarkers();    for (var i = 0; i < arr.length; i++) {        var has_epoch = false;        if ($('#epoch_button').val() == "epoch_all") has_epoch = true;        else if (Array.isArray(arr[i]['epochs']))            for (var j = 0; j < arr[i]['epochs'].length; j++)                if ("epoch_" + arr[i]['epochs'][j] == $('#epoch_button').val()) has_epoch = true;         var has_culture = false;        if ($('#culture_button').val() == "culture_all") has_culture = true;        else if (Array.isArray(arr[i]['cultures']))            for (var j = 0; j < arr[i]['cultures'].length; j++)                if ("culture_" + arr[i]['cultures'][j] == $('#culture_button').val()) has_culture = true;         var has_method = false;        if ($('#method_button').val() == "method_all") has_method = true;        else if (Array.isArray(arr[i]['methods']))            for (var j = 0; j < arr[i]['methods'].length; j++)                if ("method_" + arr[i]['methods'][j] == $('#method_button').val()) has_method = true;         var has_style = false;        if ($('#style_button').val() == "style_all") has_style = true;        else if (Array.isArray(arr[i]['styles']))            for (var j = 0; j < arr[i]['styles'].length; j++)                if ("style_" + arr[i]['styles'][j] == $('#style_button').val()) has_style = true;         if (has_epoch && has_culture && has_method && has_style) showMarker(i);    }}JS;$this->registerJs($script, yii\web\View::POS_BEGIN);$this->registerJsFile('/js/map/jquery.cookie.js', ['depends' => ['yii\bootstrap\BootstrapPluginAsset']]);if ($mapProvider == 'yandex') {    $this->registerJsFile('https://api-maps.yandex.ru/2.1/?lang=' . (Yii::$app->language == 'ru' ? 'ru_RU' : 'en_US') . '&mode=debug', ['depends' => ['yii\bootstrap\BootstrapPluginAsset']]);    $this->registerJsFile('/js/map/tiler-converter.js', ['depends' => ['yii\bootstrap\BootstrapPluginAsset']]);    $this->registerJsFile('/js/map/map_yandex.js', ['depends' => ['yii\bootstrap\BootstrapPluginAsset']]);} else {    $this->registerJsFile('/js/map/markerclusterer/src/markerclusterer.js', ['depends' => ['yii\bootstrap\BootstrapPluginAsset']]);    $this->registerJsFile('/js/map/map.js', ['depends' => ['yii\bootstrap\BootstrapPluginAsset']]);    $this->registerJsFile('https://maps.googleapis.com/maps/api/js?key=AIzaSyCeYhPhJAnwj95GXDg5BRT7Q2dTj303dQU&callback=initMap&language=' . Yii::$app->language, ['depends' => ['yii\bootstrap\BootstrapPluginAsset']]);}$this->registerJs($script2, yii\web\View::POS_END);?><div class="pull-right hidden-xs">    <?= Html::a('Google Maps', "?mapProvider=google&filter=$filter", ['class' => 'btn ' . ($mapProvider != 'yandex' ? 'btn-primary' : 'btn-default')]) ?>    <?= Html::a('Yandex Maps', "?mapProvider=yandex&filter=$filter", ['class' => 'btn ' . ($mapProvider == 'yandex' ? 'btn-primary' : 'btn-default')]) ?></div><h1><?= $this->title ?></h1><div class="visible-xs">    <div class="form-group">        <?= Html::a('Google Maps', "?mapProvider=google&filter=$filter", ['class' => 'btn ' . ($mapProvider != 'yandex' ? 'btn-primary' : 'btn-default')]) ?>        <?= Html::a('Yandex Maps', "?mapProvider=yandex&filter=$filter", ['class' => 'btn ' . ($mapProvider == 'yandex' ? 'btn-primary' : 'btn-default')]) ?>    </div></div><?= $this->render('../layouts/_filter_bar', [    'petroglyphs' => $petroglyphs,    'filter' => $filter,    'hiddens' => "<input type='hidden' name='mapProvider' value='$mapProvider'>",    'url' => Url::to(['map/index', 'mapProvider'=>$mapProvider])]) ?><div class="row">    <div class="col-xs-12 col-md-8">        <?php if ($filter): ?>            <div class="form-control alert-info text-center">                <?php if ($json_petroglyphs == '[]'): ?>                    <?= Yii::t('app', 'Nothing found') ?>                <?php else: ?>                    <?= Yii::t('app', 'The number of found petroglyphs: {n}', ['n' => count(json_decode($json_petroglyphs))]) ?>                <?php endif; ?>            </div>        <?php endif; ?>    </div></div><div id="map_canvas" style="width:100%; height:600px; float:left; margin-right: 20px;"></div><div id="search_container">    <form method="post">        <!--        <input type="text" name="name" placeholder="--><? //=lang("title");?><!--...">-->        <!--        <button type="submit" name="filter" class="btn btn-default">-->        <? //=lang("filter");?><!--</button>-->    </form></div>